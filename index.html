<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Japi</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/altOpen/Japi@main/logo.png">
<link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/gh/altOpen/Japi@main/logo.png">
<meta name="theme-color" content="#d32f2f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
  :root {
    --primary-red: #d32f2f;
    --primary-blue: #007AFF;
    --restricted-blue: #0056b3; 
    --bg-color: #f2f4f7;
    --card-bg: #ffffff;
    --text-main: #1f2937;
    --text-muted: #6b7280;
    --border-color: #e5e7eb;
    --cell-gap: 4px;
    --font-family: -apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }

  body {
    font-family: var(--font-family);
    background: var(--bg-color);
    color: var(--text-main);
    display: flex;
    justify-content: center;
    align-items: center;
    -webkit-font-smoothing: antialiased;
  }

  .container {
    width: 100%;
    height: 100%;
    max-width: 480px;
    background: var(--card-bg);
    display: flex;
    flex-direction: column;
    padding: 16px; 
    box-sizing: border-box;
    box-shadow: var(--shadow-card);
    position: relative;
  }

  @media (min-width: 500px) {
    .container {
      height: 90vh;
      border-radius: 24px;
    }
  }

  /* --- HEADER --- */
  header {
    flex-shrink: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-color);
  }

  .header-text h1 {
    margin: 0;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-muted);
    letter-spacing: 1px;
  }
  
  .header-text h2 {
    margin: 2px 0 0 0;
    font-size: 20px; 
    font-weight: 800;
    color: var(--text-main);
  }

  /* --- NAV BUTTONS --- */
  .nav-group {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .nav-btn {
    width: 38px;
    height: 38px;
    border: none;
    border-radius: 50%;
    background: #f3f4f6;
    color: var(--text-main);
    cursor: pointer;
    font-size: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.2s ease;
    -webkit-tap-highlight-color: transparent;
  }

  .nav-btn:active {
    background: var(--primary-blue);
    color: white;
    transform: scale(0.9);
  }

  /* --- LEGEND --- */
  .legend {
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin: 12px 0;
    font-size: 11px;
    color: var(--text-muted);
    font-weight: 500;
    background: #f9fafb;
    padding: 10px 12px;
    border-radius: 8px;
  }
  
  .legend-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .swatch-red { width: 12px; height: 12px; border-radius: 3px; background: var(--primary-red); }
  .swatch-blue { width: 12px; height: 12px; border-radius: 3px; background: var(--restricted-blue); }

  /* --- CALENDAR GRID --- */
  .calendar-wrapper {
    flex: 1; 
    overflow-y: auto;
    min-height: 0;
    display: flex;
    flex-direction: column;
    justify-content: start; 
  }

  .calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    width: 100%; 
    gap: var(--cell-gap);
    margin-bottom: 10px;
  }

  .dow {
    text-align: center;
    padding-bottom: 6px;
    font-weight: 600;
    font-size: 11px;
    text-transform: uppercase;
    color: #9ca3af;
    position: sticky;
    top: 0;
    background: var(--card-bg);
    z-index: 10;
  }

  .cell {
    width: 100%;
    aspect-ratio: 1 / 1; 
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    position: relative;
    background: transparent;
    -webkit-tap-highlight-color: transparent;
  }

  .cell.outside { cursor: default; }

  .day-number {
    font-size: 14px;
    font-weight: 500;
    width: 32px;
    height: 32px;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 8px;
    color: var(--text-main);
  }

  /* --- FOOTER --- */
  footer {
    flex-shrink: 0;
    padding-top: 16px;
    padding-bottom: 8px;
    border-top: 1px solid #f3f4f6;
    background: var(--card-bg);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 8px;
  }
  
  .copyright-text {
    font-size: 11px;
    font-weight: 600;
    color: #9ca3af;
  }

  .footer-logo {
    width: 102px;  
    height: 102px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    background: white;
    object-fit: cover;
    margin-bottom: 4px; 
  }

  #installBtn {
    display: none;
    background: var(--primary-blue);
    color: white;
    border: none;
    border-radius: 50px;
    padding: 10px 24px;
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 10px rgba(0, 122, 255, 0.3);
    cursor: pointer;
    transition: transform 0.2s;
    -webkit-tap-highlight-color: transparent;
  }

  #installBtn:active {
    transform: scale(0.96);
  }

  #infoBtn {
    background: transparent;
    border: none;
    padding: 4px;
    font-family: var(--font-family);
    font-size: 10px;
    font-weight: 500;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
  }

  /* --- DATE STYLES --- */
  .holiday .day-number,
  .sunday .day-number,
  .sat-special .day-number {
    background: #fee2e2;
    color: var(--primary-red);
    font-weight: 700;
  }

  .restricted .day-number {
    color: var(--restricted-blue);
    font-weight: 800;
  }

  .today .day-number {
    background: var(--primary-blue) !important;
    color: white !important;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    font-weight: 700;
  }

  /* --- MODAL --- */
  #modalOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  #modalBox {
    background: white;
    width: 85%;
    max-width: 320px;
    max-height: 80vh;
    overflow-y: auto;
    padding: 24px;
    border-radius: 20px;
    text-align: left;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    animation: popUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  #modalTitle { 
    font-size: 18px; 
    font-weight: 700; 
    margin-bottom: 12px; 
    color: var(--text-main);
    text-align: center;
  }
  
  #modalMsg { 
    font-size: 14px; 
    margin-bottom: 24px; 
    line-height: 1.6; 
    color: var(--text-main);
  }

  .legal-text {
    font-size: 12px;
    color: var(--text-muted);
    background: #f9fafb;
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    border: 1px solid #eee;
  }

  #modalClose {
    background: var(--text-main);
    color: white;
    border: none;
    padding: 12px 0;
    border-radius: 12px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    width: 100%;
  }

  @keyframes popUp {
    from { transform: scale(0.9) translateY(20px); opacity: 0; }
    to { transform: scale(1) translateY(0); opacity: 1; }
  }

</style>
</head>

<body>

<div class="container">

  <header>
    <div class="header-text">
      <h1>Assam Holiday Calendar</h1>
      <h2 id="currentDisplay"></h2>
    </div>

    <div class="nav-group">
      <button class="nav-btn" id="prevBtn">&#8592;</button>
      <button class="nav-btn" id="nextBtn">&#8594;</button>
    </div>
  </header>

  <div class="legend">
    <div class="legend-row">
      <span class="swatch-red"></span>
      <span>Holiday          </span>
      <span class="swatch-blue"></span>
      <span>Restricted Holiday</span>
    </div>
  </div>

  <div class="calendar-wrapper">
    <div class="calendar" id="calendar">
      <div class="dow">Sun</div>
      <div class="dow">Mon</div>
      <div class="dow">Tue</div>
      <div class="dow">Wed</div>
      <div class="dow">Thu</div>
      <div class="dow">Fri</div>
      <div class="dow">Sat</div>
    </div>
  </div>

  <footer>
    <img src="https://cdn.jsdelivr.net/gh/altOpen/Japi@main/logo.png" class="footer-logo" alt="Japi Logo">
    <button id="installBtn">Install App</button>
    <span class="copyright-text">All rights reserved © Manash Sharma</span>
    <button id="infoBtn">Terms and Conditions</button>
  </footer>

</div>

<div id="modalOverlay">
  <div id="modalBox">
    <div id="modalTitle">Info</div>
    <div id="modalMsg"></div>
    <button id="modalClose">Close</button>
  </div>
</div>

<script>
// --- CONTROLLED SERVICE WORKER UPDATE LOGIC ---

// STEP 2: INCREMENT THIS TO MATCH SW.JS (e.g., v2.0 -> v2.1)
const APP_VERSION = 'v2.0'; 

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    
    // Check based on version number, not random time
    const swUrl = `./sw.js?v=${APP_VERSION}`;

    navigator.serviceWorker.register(swUrl).then((registration) => {
      
      // Manual update check
      registration.update();

      if (registration.waiting) {
         showUpdateNotification(registration.waiting);
      }

      registration.addEventListener('updatefound', () => {
        const newWorker = registration.installing;
        
        newWorker.addEventListener('statechange', () => {
          // Only show notification if installed AND there is a controller
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              showUpdateNotification(newWorker);
          }
        });
      });
    });

    navigator.serviceWorker.addEventListener('controllerchange', () => {
      window.location.reload();
    });
  });
}

function showUpdateNotification(worker) {
  const updateMsg = `
    <div style="text-align:center">
      <strong>New Version Available!</strong><br><br>
      A new update is ready.<br>
      Click below to apply changes.<br><br>
      <button id="updateAppBtn" style="
        background: #d32f2f; 
        color: white; 
        border: none; 
        padding: 10px 20px; 
        border-radius: 50px; 
        font-weight: bold;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        ">
        UPDATE NOW
      </button>
    </div>
  `;
  
  showModal(updateMsg);
  
  setTimeout(() => {
    const btn = document.getElementById('updateAppBtn');
    if(btn) {
      btn.onclick = () => {
        worker.postMessage({ type: 'SKIP_WAITING' });
        // Failsafe reload
        setTimeout(() => {
            window.location.reload();
        }, 500);
      };
    }
  }, 100);
}

// --- UNIVERSAL INSTALL LOGIC ---
let deferredPrompt;
const installBtn = document.getElementById('installBtn');
const isIos = /iphone|ipad|ipod/.test(window.navigator.userAgent.toLowerCase());
const isInStandaloneMode = ('standalone' in window.navigator) && (window.navigator.standalone);

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'block'; 
});

if (isIos && !isInStandaloneMode) {
  installBtn.style.display = 'block'; 
}

installBtn.addEventListener('click', async () => {
  if (isIos) {
    showModal(`
      <div style="text-align: center;">
        <img src="https://cdn.jsdelivr.net/gh/altOpen/Japi@main/logo.png" style="width:64px; border-radius:12px; margin-bottom:12px; background:white; padding:4px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
        <br>
        <strong>Install Japi on iPhone</strong>
        <div style="text-align: left; margin-top: 15px; font-size: 13px; color: #444;">
          1. Tap the <strong>Share</strong> button <span style="font-size:16px">⎋</span> at the bottom.<br><br>
          2. Scroll down and tap <strong>"Add to Home Screen"</strong>.<br><br>
          3. Tap <strong>Add</strong> in the top right corner.
        </div>
      </div>
    `);
  } else if (deferredPrompt) {
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    deferredPrompt = null;
    if(outcome === 'accepted') installBtn.style.display = 'none';
  }
});

const MONTH_NAMES = [
  "January", "February", "March", "April", "May", "June",
  "July", "August", "September", "October", "November", "December"
];

// 2025 Full Holidays
const HOLIDAYS_2025 = {
 "1-14": "Magh Bihu and Tusu Puja", "1-15": "Magh Bihu and Tusu Puja", "1-23": "Netaji's Birth Day", "1-26": "Republic Day",
 "1-28": "Gwther Bathow San", "1-31": "Me-Dam-Me-Phi", "2-12": "Bir Chilarai Divas", "3-14": "Dol Jatra",
 "3-31": "Id-Ul-Fitre", "4-14": "Bohag Bihu", "4-15": "Bohag Bihu", "4-16": "Bohag Bihu", "4-18": "Good Friday",
 "4-21": "Sati Sadhini Divas", "4-28": "Tithi of Damodar Dev", "5-1": "May Day", "5-12": "Buddha Purnima",
 "6-7": "Id-U'l-Zuha", "6-12": "Janmotsav of Shri Shri Madhabdeva", "8-15": "Independance Day",
 "8-25": "Tirubhav Tithi of Srimanta Sankardeva", "9-3": "Karam Puja", "9-12": "Tirubhav Tithi of Srimanta Madhabdeva",
 "9-29": "Durga Puja", "9-30": "Durga Puja", "10-1": "Durga Puja",
 "10-2": "Vijoya Dashomi, Janmotsav of Sri Sri Sankardeva and Birth Day of Mahatma Gandhi", "10-6": "Kati Bihu",
 "10-18": "Kali Puja and Diwali", "10-20": "Bhatri Dwitiya", "10-23": "Chhat Puja", "11-24": "Lachit Divas",
 "12-2": "Asom Divas (Su-Ka-Pha Divas)", "12-25": "Christmas Day"
};

// 2026 Full Holidays
const HOLIDAYS_2026 = {
 "1-14":"Magh Bihu and Tusu Puja", "1-15":"Magh Bihu and Tusu Puja", "1-23":"Netaji's Birth Day", "1-26":"Republic Day",
 "1-27":"Gwthar Bathou San", "1-31":"Me-Dam-Me-Phi", "2-1":"Bir Chilaray Divas", "3-3":"Dol Jatra", "3-21":"Id-Ul-Fitr",
 "4-3":"Good Friday", "4-14":"Bohag Bihu", "4-15":"Bohag Bihu", "4-16":"Bohag Bihu", "4-18":"Tithi of Damodar Deva",
 "4-21":"Sati Sadhini Divas", "5-1":"May Day and Budha Purnima", "5-27":"Id-ul-Zuha", "6-1":"Janmotsav of Sri Sri Madhabdeva",
 "8-15":"Independence Day", "9-1":"Tirubhav Tithi of Sri Sri Madhabdeva", "9-4":"Janmastomi", "9-12":"Tirubhav Tithi of Srimanta Sankardeva",
 "9-21":"Janmotsav of Srimanta Sankardeva", "9-22":"Karam Puja", "10-2":"Birthday of Mahatma Gandhi", "10-18":"Kati Bihu and Durga Puja",
 "10-19":"Durga Puja", "10-20":"Durga Puja", "10-21":"Vijaya Dashami", "10-25":"Half Holiday at 1:00 PM: Lakshmi Puja",
 "11-8":"Kali Puja and Diwali", "11-11":"Bhatri Dwitiya", "11-15":"Chhath Puja", "11-24":"Guru Nanak's Birthday and Lachit Divas",
 "12-2":"Asom Divas (Su-Ka-Pha Divas)", "12-25":"Christmas Day"
};

// --- RESTRICTED HOLIDAYS 2026 ---
const RESTRICTED_HOLIDAYS_2026 = {
 "1-1": "New Year Day", "1-5": "Rongker Karkli", "1-13": "Uruka of Magh Bihu", "1-17": "Silpi Divas",
 "1-27": "Busu Dima Festival", "2-4": "Shab-E-Barat", "2-15": "Sivaratri", "2-17": "Karbi-Dehal-Kachir Dom",
 "2-18": "Ali Aye Ligang", "3-2": "Khring Khring Baithow Puja", "3-17": "Lailatur Qadar", "3-25": "Tora Chira Bihu",
 "3-31": "Mahabir Jayanti", "4-4": "Easter Saturday", "4-15": "Deuri Bihu", "4-18": "Birthday of Gurudev Kalicharan Brahma",
 "4-22": "Tithi of Gopal Dev", "5-1": "Sati Radhika Utsav", "5-16": "Tithi of Hari Dev", "5-23": "Birthday of Sri Sri Krishnaguru",
 "5-24": "Motak Roja Swargadeo Sarbananda Singha Divas", "5-31": "Baikhowa Festival", "6-20": "Death Anniversary of Bishnu Prasad Rabha",
 "6-30": "Hul Divas", "7-13": "Birthday of Nepali Poet Bhanu Bhakta Acharya", "8-13": "Death Anniversary of Bir Tikendrajit",
 "8-26": "Fateha-e-Dwaz-Daham", "9-15": "Nau Khai Festival", "9-16": "Birthday of Sri Sri Thakur Anukul Chandra",
 "11-1": "Kuki Chavang Kut", "11-7": "Wangala Festival", "11-11": "Abhibhav Tithi of Sri Sri Bhubaneswar Sadhu Thakur",
 "11-19": "Bir Raghav Moran Divas", "11-24": "Death Anniversary of Guru Teg Bahadur Ji", "12-5": "Sikpui Ruoi",
 "12-10": "Martyr's Day", "12-19": "Death Anniversary of Shree Shree Aniruddhadev", "12-22": "Gaan Ngai", "12-24": "Christmas Eve"
};

let viewDate = new Date(); 
const realToday = new Date();

const calendarEl = document.getElementById("calendar");
const displayEl = document.getElementById("currentDisplay");
const modalOverlay = document.getElementById("modalOverlay");
const modalMsg = document.getElementById("modalMsg");
const modalTitle = document.getElementById("modalTitle");

document.getElementById("prevBtn").onclick = ()=>changeMonth(-1);
document.getElementById("nextBtn").onclick = ()=>changeMonth(1);
document.getElementById("modalClose").onclick = ()=>modalOverlay.style.display="none";

document.getElementById("infoBtn").onclick = function() {
    const infoContent = `
        <strong>Version:</strong> 2025.26.11.V1<br><br>
        <strong>Special Thanks:</strong><br>Abinash Kalita for testing and suggestions.<br><br>
        <div class="legal-text">
        <strong>Terms & Conditions / Disclaimer:</strong><br><br>
        1. <strong>Personal Use Only:</strong> This calendar is created for personal reference and is not an official government document.<br><br>
        2. <strong>No Liability:</strong> The developer assumes no responsibility for any errors, omissions, or inaccuracies in the dates provided. Users are advised to verify holidays with official notifications.<br><br>
        3. <strong>Indemnity:</strong> By using this application, you agree that the developer is free from any liability claims, losses, or damages arising from its use, as per applicable Indian laws.
        </div>
    `;
    modalTitle.textContent = "About";
    modalMsg.innerHTML = infoContent;
    modalOverlay.style.display = "flex";
};

function showModal(msg){
  modalTitle.textContent = "Assam Holiday Calendar";
  modalMsg.innerHTML = msg; 
  modalOverlay.style.display = "flex";
}

function changeMonth(delta){
  viewDate.setMonth(viewDate.getMonth() + delta);
  renderCalendar();
}

function renderCalendar(){
  while(calendarEl.children.length > 7) {
    calendarEl.removeChild(calendarEl.lastElementChild);
  }

  const y = viewDate.getFullYear();
  const m = viewDate.getMonth();
  const first = new Date(y, m, 1);
  const last = new Date(y, m+1, 0);

  displayEl.textContent = MONTH_NAMES[m] + " " + y;

  const startIndex = first.getDay();
  for(let i=0;i<startIndex;i++) calendarEl.appendChild(createCell(null,true));

  let saturdays = [];
  for(let d=1; d<=last.getDate(); d++){
    if(new Date(y,m,d).getDay() === 6) saturdays.push(d);
  }
  const secondSat = saturdays[1];
  const fourthSat = saturdays[3];

  let currentHolidayList = (y === 2025) ? HOLIDAYS_2025 : (y === 2026 ? HOLIDAYS_2026 : {});
  let currentRestrictedList = (y === 2026) ? RESTRICTED_HOLIDAYS_2026 : {};

  for(let d=1; d<=last.getDate(); d++){
    const dt = new Date(y,m,d);
    const dow = dt.getDay();
    const key = `${m+1}-${d}`;

    let classes = [];
    
    let holidayName = currentHolidayList[key];
    let isHoliday = !!holidayName;

    let restrictedName = currentRestrictedList[key];
    let isRestricted = !!restrictedName;

    if(isHoliday) classes.push("holiday");
    else if(isRestricted) classes.push("restricted"); 
    
    if(dow === 0) classes.push("sunday");
    if(dow === 6 && (d === secondSat || d === fourthSat)) classes.push("sat-special");

    if(y === realToday.getFullYear() && m === realToday.getMonth() && d === realToday.getDate()) {
        classes.push("today");
    }

    calendarEl.appendChild(
      createCell({
        year:y, month:m, day:d, dateObj:dt, key,
        isHoliday, holidayName,
        isRestricted, restrictedName,
        secondSat, fourthSat
      }, false, classes)
    );
  }
}

function createCell(info, outside, classes=[]){
  const cell = document.createElement("div");
  cell.className = "cell" + (outside ? " outside":"") + (classes.length?" "+classes.join(" "):"");

  const num = document.createElement("div");
  num.className = "day-number";
  num.textContent = info ? info.day : "";
  cell.appendChild(num);

  if(!outside && info){
    cell.onclick = function() { handleDateClick(info); };
  }
  return cell;
}

function handleDateClick(info){
  const dow = info.dateObj.getDay();
  let msg = "";

  if(info.isHoliday){
    msg = info.holidayName;
    if(dow === 0) msg += " (Sunday)";
    else if(dow === 6){
      if(info.day === info.secondSat) msg += " (Second Saturday)";
      else if(info.day === info.fourthSat) msg += " (Fourth Saturday)";
    }
    showModal(msg);
    return;
  }

  if(info.isRestricted){
    msg = "Restricted Holiday: " + info.restrictedName;
    if(dow === 0) msg += " (Sunday)";
    else if(dow === 6){
      if(info.day === info.secondSat) msg += " (Second Saturday)";
      else if(info.day === info.fourthSat) msg += " (Fourth Saturday)";
    }
    showModal(msg);
    return;
  }

  if(dow === 0){ showModal("Sunday"); return; }

  if(dow === 6){
    if(info.day === info.secondSat){ showModal("Second Saturday of the Month"); return; }
    if(info.day === info.fourthSat){ showModal("Fourth Saturday of the Month"); return; }
  }

  showModal(info.day + " " + MONTH_NAMES[info.dateObj.getMonth()] + " " + info.dateObj.getFullYear());
}

renderCalendar();
</script>

</body>
</html>
